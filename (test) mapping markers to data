import json
import os


# Load JSON Files
with open('json_files/file_0.json', 'r') as f1, open('aruco_codes.json', 'r') as f2:
    data_file = json.load(f1) # These are the markers detected by the camera
    codes_file = json.load(f2) # This is the 'key' mapping aruco codes to into about them

# Extract the aruco ids from JSON file #1 and the index
data = data_file.get('data', [])
#print(f"Data: {data}") # Data is a list like [ [13, [233, 253]], [9, [267, 252]] ]

codes = codes_file.get('Codes', {})
#print(f"Codes: {codes}")

# Map aruco_ids to corresponding codes
mapped_data = []
index = 0

# Go through each detected aruco marker, "item"
for item in data:
    aruco_id = item[0] # This is the one we want to check against in the 'keys'
    #print(aruco_id)
    #print("Aruco ID:",aruco_id)

    for key, value in codes.items():
        if value['aruco_id'] == aruco_id:
            print(f"Aruco ID {aruco_id} is '{key}': {value}")
            name = key
            color = value['color']

            mapped_entry = {
            'aruco_id': aruco_id,
            'name': name,
            'color': color,
            'grid_position': index
            #'height': height
        }
            mapped_data.append(mapped_entry)
            break

    index += 1
    #input("Enter")

print(mapped_data)

answer = input("Save data? Enter 'Y' or 'N': ")
if answer == "Y":
    # Store the file
    file_path = os.path.join('mapped_data', f'data.json')
    json_str = json.dumps(mapped_data, indent=4)
    with open(file_path, 'w') as json_file:
        json_file.write(json_str)
        print(f"List saved as JSON file: data.json")

#for entry in mapped_data:
#    print(entry)
